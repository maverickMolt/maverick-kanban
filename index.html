<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Maverick Kanban</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0d1117; color: #c9d1d9; min-height: 100vh; }
    .header { background: #161b22; padding: 1rem 2rem; border-bottom: 1px solid #30363d; display: flex; justify-content: space-between; align-items: center; }
    .header h1 { font-size: 1.5rem; display: flex; align-items: center; gap: 0.5rem; }
    .header h1 span { font-size: 1.5rem; }
    .add-btn { background: #238636; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.9rem; }
    .add-btn:hover { background: #2ea043; }
    .board { display: flex; gap: 1rem; padding: 1.5rem; overflow-x: auto; min-height: calc(100vh - 60px); }
    .column { background: #161b22; border-radius: 8px; min-width: 300px; max-width: 300px; display: flex; flex-direction: column; }
    .column-header { padding: 1rem; font-weight: 600; border-bottom: 1px solid #30363d; display: flex; justify-content: space-between; align-items: center; }
    .column-header .count { background: #30363d; padding: 0.2rem 0.5rem; border-radius: 10px; font-size: 0.8rem; }
    .tasks { padding: 0.5rem; flex: 1; min-height: 100px; }
    .task { background: #0d1117; border: 1px solid #30363d; border-radius: 6px; padding: 0.75rem; margin-bottom: 0.5rem; cursor: grab; }
    .task:hover { border-color: #58a6ff; }
    .task.dragging { opacity: 0.5; }
    .task-title { font-weight: 500; margin-bottom: 0.25rem; }
    .task-meta { font-size: 0.75rem; color: #8b949e; display: flex; gap: 0.5rem; flex-wrap: wrap; }
    .task-meta .priority { padding: 0.1rem 0.4rem; border-radius: 3px; }
    .priority-high { background: #f85149; color: white; }
    .priority-medium { background: #d29922; color: white; }
    .priority-low { background: #388bfd; color: white; }
    .task-actions { display: flex; gap: 0.5rem; margin-top: 0.5rem; }
    .task-actions button { background: none; border: none; color: #8b949e; cursor: pointer; font-size: 0.75rem; }
    .task-actions button:hover { color: #c9d1d9; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); justify-content: center; align-items: center; z-index: 100; }
    .modal.active { display: flex; }
    .modal-content { background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 1.5rem; width: 90%; max-width: 400px; }
    .modal-content h2 { margin-bottom: 1rem; }
    .form-group { margin-bottom: 1rem; }
    .form-group label { display: block; margin-bottom: 0.25rem; font-size: 0.9rem; color: #8b949e; }
    .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 0.5rem; background: #0d1117; border: 1px solid #30363d; border-radius: 4px; color: #c9d1d9; font-size: 0.9rem; }
    .form-group textarea { min-height: 80px; resize: vertical; }
    .modal-actions { display: flex; gap: 0.5rem; justify-content: flex-end; }
    .modal-actions button { padding: 0.5rem 1rem; border-radius: 4px; border: none; cursor: pointer; }
    .btn-cancel { background: #30363d; color: #c9d1d9; }
    .btn-save { background: #238636; color: white; }
    .btn-delete { background: #f85149; color: white; }
    .drop-zone { border: 2px dashed #30363d; border-radius: 6px; min-height: 50px; margin: 0.5rem; }
    .drop-zone.over { border-color: #58a6ff; background: rgba(88,166,255,0.1); }
    .assignee { display: inline-flex; align-items: center; gap: 0.25rem; }
    .assignee.matt { color: #a371f7; }
    .assignee.maverick { color: #58a6ff; }
  </style>
</head>
<body>
  <div class="header">
    <h1><span>ü¶Ö</span> Maverick Kanban</h1>
    <button class="add-btn" onclick="openModal()">+ Add Task</button>
  </div>
  
  <div class="board" id="board">
    <div class="column" data-status="backlog">
      <div class="column-header">üìã Backlog <span class="count" id="count-backlog">0</span></div>
      <div class="tasks" id="tasks-backlog"></div>
    </div>
    <div class="column" data-status="todo">
      <div class="column-header">üìù To Do <span class="count" id="count-todo">0</span></div>
      <div class="tasks" id="tasks-todo"></div>
    </div>
    <div class="column" data-status="in-progress">
      <div class="column-header">üî® In Progress <span class="count" id="count-in-progress">0</span></div>
      <div class="tasks" id="tasks-in-progress"></div>
    </div>
    <div class="column" data-status="done">
      <div class="column-header">‚úÖ Done <span class="count" id="count-done">0</span></div>
      <div class="tasks" id="tasks-done"></div>
    </div>
  </div>

  <div class="modal" id="modal">
    <div class="modal-content">
      <h2 id="modal-title">Add Task</h2>
      <input type="hidden" id="task-id">
      <div class="form-group">
        <label>Title</label>
        <input type="text" id="task-title" placeholder="What needs to be done?">
      </div>
      <div class="form-group">
        <label>Description</label>
        <textarea id="task-desc" placeholder="Details..."></textarea>
      </div>
      <div class="form-group">
        <label>Assignee</label>
        <select id="task-assignee">
          <option value="maverick">ü¶Ö Maverick</option>
          <option value="matt">üë§ Matt</option>
        </select>
      </div>
      <div class="form-group">
        <label>Priority</label>
        <select id="task-priority">
          <option value="low">Low</option>
          <option value="medium">Medium</option>
          <option value="high">High</option>
        </select>
      </div>
      <div class="form-group">
        <label>Status</label>
        <select id="task-status">
          <option value="backlog">Backlog</option>
          <option value="todo">To Do</option>
          <option value="in-progress">In Progress</option>
          <option value="done">Done</option>
        </select>
      </div>
      <div class="modal-actions">
        <button class="btn-delete" id="btn-delete" onclick="deleteTask()" style="display:none;">Delete</button>
        <button class="btn-cancel" onclick="closeModal()">Cancel</button>
        <button class="btn-save" onclick="saveTask()">Save</button>
      </div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = 'maverick-kanban-tasks';
    let tasks = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

    function saveTasks() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
    }

    function render() {
      ['backlog', 'todo', 'in-progress', 'done'].forEach(status => {
        const container = document.getElementById(`tasks-${status}`);
        const statusTasks = tasks.filter(t => t.status === status);
        document.getElementById(`count-${status}`).textContent = statusTasks.length;
        
        container.innerHTML = statusTasks.map(task => `
          <div class="task" draggable="true" data-id="${task.id}" ondragstart="dragStart(event)" ondragend="dragEnd(event)" onclick="editTask('${task.id}')">
            <div class="task-title">${escapeHtml(task.title)}</div>
            ${task.desc ? `<div style="font-size:0.8rem;color:#8b949e;margin:0.25rem 0;">${escapeHtml(task.desc).substring(0,60)}${task.desc.length > 60 ? '...' : ''}</div>` : ''}
            <div class="task-meta">
              <span class="priority priority-${task.priority}">${task.priority}</span>
              <span class="assignee ${task.assignee}">${task.assignee === 'maverick' ? 'ü¶Ö' : 'üë§'} ${task.assignee}</span>
            </div>
          </div>
        `).join('');
      });
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function openModal(taskId = null) {
      document.getElementById('modal').classList.add('active');
      document.getElementById('modal-title').textContent = taskId ? 'Edit Task' : 'Add Task';
      document.getElementById('btn-delete').style.display = taskId ? 'block' : 'none';
      
      if (taskId) {
        const task = tasks.find(t => t.id === taskId);
        document.getElementById('task-id').value = task.id;
        document.getElementById('task-title').value = task.title;
        document.getElementById('task-desc').value = task.desc || '';
        document.getElementById('task-assignee').value = task.assignee;
        document.getElementById('task-priority').value = task.priority;
        document.getElementById('task-status').value = task.status;
      } else {
        document.getElementById('task-id').value = '';
        document.getElementById('task-title').value = '';
        document.getElementById('task-desc').value = '';
        document.getElementById('task-assignee').value = 'maverick';
        document.getElementById('task-priority').value = 'medium';
        document.getElementById('task-status').value = 'backlog';
      }
    }

    function closeModal() {
      document.getElementById('modal').classList.remove('active');
    }

    function editTask(id) {
      openModal(id);
    }

    function saveTask() {
      const id = document.getElementById('task-id').value;
      const title = document.getElementById('task-title').value.trim();
      if (!title) return alert('Title required');

      const taskData = {
        id: id || Date.now().toString(),
        title,
        desc: document.getElementById('task-desc').value.trim(),
        assignee: document.getElementById('task-assignee').value,
        priority: document.getElementById('task-priority').value,
        status: document.getElementById('task-status').value,
        updated: new Date().toISOString()
      };

      if (id) {
        const idx = tasks.findIndex(t => t.id === id);
        tasks[idx] = { ...tasks[idx], ...taskData };
      } else {
        taskData.created = new Date().toISOString();
        tasks.push(taskData);
      }

      saveTasks();
      render();
      closeModal();
    }

    function deleteTask() {
      const id = document.getElementById('task-id').value;
      if (confirm('Delete this task?')) {
        tasks = tasks.filter(t => t.id !== id);
        saveTasks();
        render();
        closeModal();
      }
    }

    // Drag and drop
    let draggedId = null;

    function dragStart(e) {
      draggedId = e.target.dataset.id;
      e.target.classList.add('dragging');
      document.querySelectorAll('.tasks').forEach(el => el.classList.add('drop-zone'));
    }

    function dragEnd(e) {
      e.target.classList.remove('dragging');
      document.querySelectorAll('.tasks').forEach(el => el.classList.remove('drop-zone', 'over'));
    }

    document.querySelectorAll('.tasks').forEach(zone => {
      zone.addEventListener('dragover', e => {
        e.preventDefault();
        zone.classList.add('over');
      });
      zone.addEventListener('dragleave', () => zone.classList.remove('over'));
      zone.addEventListener('drop', e => {
        e.preventDefault();
        const newStatus = zone.id.replace('tasks-', '');
        const task = tasks.find(t => t.id === draggedId);
        if (task) {
          task.status = newStatus;
          task.updated = new Date().toISOString();
          saveTasks();
          render();
        }
      });
    });

    // Close modal on outside click
    document.getElementById('modal').addEventListener('click', e => {
      if (e.target.id === 'modal') closeModal();
    });

    // Initial render
    render();
  </script>
</body>
</html>
